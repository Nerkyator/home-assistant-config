restart_ha:
  alias: 'Reiniciar HA'
  sequence:
      - service: homeassistant.restart

reboot_pi:
  alias: 'Reiniciar Pi'
  sequence:
      - service: shell_command.reboot_pi

power_off_thermostat:
  alias: 'Power off thermostat'
  sequence:
    - service: climate.set_temperature
      entity_id: climate.termostato
      data:
        temperature: 11.5

power_on_thermostat:
  alias: 'Power on thermostat'
  sequence:
    - service: climate.set_away_mode
      entity_id: climate.termostato
      data:
        away_mode: false

empty_home:
  alias: 'Empty home'
  sequence:
    # Turn on presence detection
    - service: homeassistant.turn_on
      data:
        entity_id: group.deteccion_movimiento
    # Continue script only if switch.heating is on
    - condition: state
      entity_id: switch.heating
      state: 'on'
   # Turn on thermostat away mode 
    - service: climate.set_away_mode
      entity_id: climate.termostato
      data:
        away_mode: true

someone_home:
  alias: 'Someone at home'
  sequence:
    # Turn off presence detection
    - service: homeassistant.turn_off
      data:
        entity_id: group.deteccion_movimiento
    # Continue script only if switch.heating is on
    - condition: state
      entity_id: switch.heating
      state: 'on'
   # Turn off thermostat away mode 
    - service: climate.set_away_mode
      entity_id: climate.termostato
      data:
        away_mode: false

blink_check_light_on_off:
  alias: 'Blink check light on off'
  sequence:
    - condition: state
      entity_id: switch.luces_navidad
      state: 'off'
    - service: homeassistant.turn_on
      data:
        entity_id: switch.luces_navidad
    - delay:
        # time for flash light on
        seconds: 1
    - service: homeassistant.turn_off
      data:
        entity_id: switch.luces_navidad

blink_check_light_off_on:
  alias: 'Blink light off on'
  sequence:
    - condition: state
      entity_id: switch.luces_navidad
      state: 'on'
    - service: homeassistant.turn_off
      data:
        entity_id: switch.luces_navidad
    - delay:
        # time for flash light off
        seconds: 1
    - service: homeassistant.turn_on
      data:
        entity_id: switch.luces_navidad

close_fence_if_open:
  alias: 'Close fence if open'
  sequence:
    # Check if fence is open
    - condition: state
      entity_id: sensor.fence_status
      state: 'abierta'
    - service: homeassistant.turn_on
      data:
        entity_id: switch.barrera

#security_check:
#  alias: 'Security check'
#  sequence:
#    # Check if fence is open
#    - service: script.turn_on
#      data:
#        entity_id: script.check_if_fence_is_open
  
goto_sleep:
  alias: 'Go to sleep'
  sequence:
    # Only execute script between 21:00 and 6:00
    - condition: time
      after: '21:00'
      before: '6:00'
    # Security check
#    - service: script.turn_on
#      data:
#        entity_id: script.security_check
    # Close fence if open
    - service: script.turn_on
      data:
        entity_id: script.close_fence_if_open
    # Turn off outside lights
    - service: light.turn_off
      data:
        entity_id: group.luces_exteriores
    # The check light has to be the last to be turned off after a small delay
    # otherwise it won't turn off
    - delay:
        seconds: 5
    # Turn off christmas lights (also check light)
    - service: homeassistant.turn_off
      data:
        entity_id: switch.luces_navidad
